#### 路由器端口	
	(1)RJ-45端口。这种端口通过双绞线连接以太网。10Base-T的RJ-45端口标识位ETH，100Base-TX的RJ-45端口标识位10/100bTX，这是因为快速以太网路由器采用10/100Mbps自适应电路。
	(2)AUI端口。AUI端口是一种D型15针连接器，用在令牌环网或总线型以太网中。路由器经AUI端口通过粗同轴电缆收发器连接10Base-5网络，也可以通过外接的AUI-to-RJ-45适配器连接10Base-T以太网，还可以借助其他类型的适配器实现与10Base-2细同轴电缆或10Base-F光缆的连接。

![](https://i.imgur.com/LCm8tzT.png)

	(3)高速同步串口。在路由器与广域网的连接中，应用最多的是高速同步串行口(Synchronous Serial Port)，这种端口用于连接DDN、帧中继、X.25和PSTN等网络。通过这种端口所连接的网络两端要求同步通信，以很高的速率进行数据传输。
	(4)ISDN BRI端口。ISDN BRI端口通过ISDN线路实现路由器与Internet或其他网络的远程连接。ISDN BRI的3个通道（2B+D）的总宽带位144kbps，端口采用RJ-45标准，与ISDN NT1的连接使用RJ-45-to-RJ-45直通线。
	(5)异步串口。异步串口（ASYNC）主要应用于与Modem或Modem池的连接，以实现远程计算机通过PSTN拨号接入。异步端口的速率不是很高，也不要求同步传输，只要求能连续通信。

![](https://i.imgur.com/7EIUsHK.png)
	
	(6)Console端口。Console端口通过配置专用电缆连接至计算机串行口，利用终端仿真程序（如Hyper Terminal）对路由器进行本地配置。路由器的Console端口为RJ-45口。Console端口不支持硬件流控。
	(7)AUX端口。对路由器进行远程配置时要使用AUX端口（Auxiliary Port）。AUX端口与Modem进行连接必须借助 RJ-45 to DB9 或 RJ-45 to DB25适配器进行电路转换。AUX端口支持硬件控流。

#### 交换机的端口参数
	交换机Console端口的默认参数：
	端口速率：9600bps
	数据位：8
	奇偶校验：无
	停止位：1
	流控：无

网络的分层结构把复杂的大型网络分解为多个容易管理的小型网络，每一层交换设备分别实现不同的特定任务。

![](https://i.imgur.com/ZuaIh2V.png)

	交换机根据层次型结构划分：
	接入层交换机。接入层是工作站连接的入口，实现用户的网络访问控制，这一层的交换机应该以低成本提供高密度的接入网络。
	汇聚层交换机。汇聚层将网络划分为多个广播/组播域，可以实现VLAN间的路由选择，并通过访问控制列表实现分组过滤。
	汇聚层交换机的端口数量和交换速率要求不是很高，但应提供第三层交换功能。
	核心层交换机。核心层应采用可扩展的高性能交换机组成园区网的主干线路，提供链路冗余、路由冗余、VLAN中继和负载均衡等功能，并且与汇聚层交换机具有兼容的技术，支持相同的协议。

	在有第三层交换功能的基础上，VLAN之间可以通信。

##### 交换机支持的以太网协议

![](https://i.imgur.com/5TdMlmv.png)
![](https://i.imgur.com/LCSF7i7.png)

##### 交换机的基本配置
	
	默认配置下，所有接口处于可用状态，并且都属于VLAN1，这种情况下交换机就可以正常工作了。但是为了方便管理和使用，首先应对交换机做基本的配置。

	(1)配置交换机的设备名称，管理VLAN和TELNET，在对网络中交换机进行管理时需要对交换机进行基本配置。
	
	<HUAWEI>                                       //进入视图提示符
	<HUAWEI>system-view                            //进入系统视图
	[HUAWEI]sysname Switch1                        //修改设备名称SW1
	[Switch1]vlan 5                                //创建交换机管理VLAN5
	[Switch-VLAN5]management-vlan
	[Switch-VLAN5]quit
	[Switch1]interface vlanif 5                    //创建交换机管理VLAN的VLANIF接口
	[Switch1-vlanif5]ip address 10.10.1.1 24       //配置VLANIF接口IP地址
	[Switch1-vlanif5]quit
	[Switch1]telnet server enable                  //Telnet默认时关闭的，需要打开
	[Switch1]user-interface vty 0 4                //开启TTY线路模式
	[Switch-ui-vty0-4]protocol inbound telnet      //配置telnet协议
	[Switch-ui-vty0-4]authentication-mode aaa      //配置认证方式
	[Switch-ui-vty0-4]quit
	[Switch]aaa
	[Switch-aaa]local-user admin password irreversible-cipher Hello@123
	//配置用户名和密码，用户名不区分大小写，密码区分大小写
	[Switch-aaa]local-user admin pricilege level 15
	//将管理员的账号权限设置为15（最高）
	[Switch-aaa]quit
	[Switch]quit
	<Switch1>save                                 //在用户视图下保存配置

	(2)登录Telnet到交换机，出现用户视图提示符
	
	C:\Documents and Setting\Administrator>telnet 10.10.1.1
	//输入交换机管理IP
	Login authentication                   //输入用户名和密码
	Username: admin
	Password:
	Info: The max number of VTY users is 5, and the number 
	  of current VTY users on line is 1.
	      The current login time is 2016-07-03 13:33:18+00:00.
	<Switch1>                            //用户视图命令行提示符
	
	(3)配置交换机的接口。交换机的接口属性默认支持一般网络环境，一般情况下是不需要对其接口进行设置的。在某些情况下需要对其端口属性进行配置时，配置的对象主要有接口隔离、速率、双工等信息。
	
	#配置接口GE1/0/1和GE1/0/2的端口隔离功能，实现两个接口之间的二层数据隔离，三层数据互通
	<Switch1>system-view
	[Switch1]port-isolate mode 12
	[Switch1]interface gigabitenthernet 1/0/1
	[Switch1-GigabitEthernet1/0/1]port enable group 1
	[Switch1-GigabitEthernet1/0/1]quit
	[Switch1]interface gigabitethernet 1/0/2
	[Switch1-GigabitEthernet1/0/2]port-isolate enable group 1
	[Switch1-GigabitEthernet1/0/2]quit

	#配置以太网接口GE0/0/1在自动协商模式下协商速率为100Mb/s
	<Switch1>system-view
	[Switch1]interface gigabitethernet 0/0/1
	[Switch1-GigabitEthernet0/0/1]negotiation auto
	[Switch1-GigabitEthernet0/0/1]auto speed 100
	
	#配置以太网电接口GE0/0/1在自动协商模式下双工模式为全双工模式
	<Switch1>system-view
	[Switch1]interface gigabitethernet 0/0/1
	[Switch1-GigabitEthernet0/0/1]negotiation auto

	(4)查看和配置MAC地址表。交换机通过学习网络中设备的MAC地址，并将学习得到的MAC地址存放在交换机的缓存中。在需要向目标地址发送数据时就从MAC表地址中查找相应地址，找到后才可以向目标快速发送数据。
	MAC表由多条MAC地址表组成。MAC地址表项由MAC、VLAN和端口组成，交换机在收到数据帧时，会解析出数据帧的源MAC地址和VLAN ID并与接受数据帧的端口组合成一条数据表项。MAC地址表项的查看可以了解交换机运行的状态信息，排查故障。
	
	#执行命令display mac-address，查看所有的MAC地址表项
	<Swtich1>display mac-address
	---------------------------------------------------------
	MAC Address         VLAN/VSI    Learned-Form    Type
	---------------------------------------------------------
	00e0-0900-7890      10/-        -               blackhole
	00e0-0230-1234      20/-        GE1/0/1         static
	0001-0002-0003      30/-        Eth-Trunk1      dynamic
	---------------------------------------------------------
	Total items displayed = 3
	
	#执行命令display interface vlanif5，显示VLANIF接口的MAC地址
	<Switch1>display interface vlanif5
	Vlanif5 current state: DOWN
	Line protocol current state: DOWN
	Description:
	Route Port, The Maximum Transmit Unit is 1500
	Internet Address is 192.168.1.1/24
	IP Sending Frames' Format is PKTFMT_ETHNT_2, Hardware address is 00e0-0987-7891
	Current system time: 2016-07-03 13:33:09+08:00
	    Input bandwidth utilization: --
	    Output bandwidth utilization: --

	#在MAC地址表中增加静态MAC地址表项，目的MAC地址0001-0002-0003，VLAN 5的报文，从接口gigabitethernet0/0/5转发出去
	[Switch1]mac-address static 0001-0002-0003 gigabitethernet 0/0/5 vlan 5

#### 配置和管理VLAN
	
###### 链路和接口类型
	
	为了适应不同的网络环境的组网需要，链路类型分为接入链路（Access Link）和干道链路（Trunk Link）两种链路类型。
	接入链路只能承载1个VLAN的数据帧，用于连接交换机和用户终端；
	干道链路能承载多个不同VLAN的数据帧，用于交换机间互连或连接交换机或路由器以及公网与私网的互联等。
	GARP协议主要用于建立一种属性传递扩散的机制，以保证协议实体能够注册和销毁该属性。
	简单的说就是为了简化网络中配置VLAN的操作，通过GVRP的VLAN自动注册功能将设备上的VLAN信息快速复制到整个交换网，达到减少手工配置量保证VLAN配置正确的目的。
	交换机的初始状态是工作在透明模式，有一个默认的VLAN1，所有端口都属于VLAN1。

##### 接入层交换机的VLAN划分
	
	#基于接口划分VLAN
	<HUAWEI>system-view                           //进入交换机系统视图
	[HUAWEI]sysname SwitchA                       //交换机命名
	[SwtichA]vlan batch 2                         //批量方式建立VLAN 2
	[SwitchA]interface gigabitethernet 0/0/1      //进入交换机接口视图
	[SwitchA-GigabitEthernet0/0/1]port link-type access   //配置接口类型
	[SwitchA-GigabitEthernet0/0/1]port default vlan 2       //将接口加入VLAN2
	[SwitchA-GigabitEthernet0/0/1]quit
	[SwitchA]interface gigabitethernet 0/0/2    //在接口视图配置上联接口
	[SwitchA-GigabitEthernet0/0/2]port link-type trunk    //配置上联接口类型
	[SwitchA-GigabitEthernet0/0/2]port trunk allow-pass vlan2   //通过VLAN2
	[SwitchA-GigabitEthernet]quit

	#基于MAC地址划分VLAN
	<HUAWEI>system-view
	[HUAWEI]sysname SwitchA
	[SwitchA]vlan batch 2
	[SwitchA]interface gigabitethernet 0/0/1    //在接口视图配置上联接口
	[SwitchA-GigabitEthernet0/0/1]port link-type bybird		//配置上联接口类型
	[SwitchA-GigabitEthernet0/0/1]port hybrid tagged vlan 2   //通过VLAN2
	[SwitchA-GigabitEthernet0/0/1]quit
	[SwitchA]interface gigabitethernet 0/0/2
	[SwitchA-GigabitEthernet0/0/2]port link-type hybrid
	[SwitchA-GigabitEtherney0/0/2]port hybrid tagged valn 2
	[SwitchA-GigabitEthernet0/0/2]quit
	[SwitchA]vlan 2
	[SwitchA-vlan2]mac-vlan mac-address 22-22-22  //PC的MAC地址与VLAN2关联
	[SwitchA-vlan2]quit
	[SwitchA]interface gigabitethernet 0/0/2
	[SwtichA-GigabitEthernet0/0/2]mac-vlan enable  //基于MAC地址启用接口
	[SwitchA-GigabitEthernet0/0/2]quit

##### 配置GARP协议
	
	GARP（Generic Attribute Registration Protocol）是通用属性注册协议的应用，提供802.1Q兼容的VLAN裁剪VLAN prunning功能和在802.1Q干线端口trunk port上建立动态VLAN的功能。
	
![](https://i.imgur.com/K9SR1ZB.png)

在交换机A、B分别配置全局启用GARP功能，达到所有子网设备互访的目的。
	
	#配置交换机A，全局启用GARP功能
	<HUAWEI>system-view
	[HUAWEI]sysname SwitchA
	[SwitchA]garp
	
	#配置接口为Trunk类型，并允许所有VLAN通过
	[SwitchA]interface gigabitethernet 0/0/1
	[SwitchA-GigabitEthernet0/0/1]port link-type trunk
	[SwitchA-GigabitEthernet0/0/1]port trunk allow-pass vlan all
	[SwitchA-GigabitEthernet0/0/1]quit
	[SwitchA]interface gigabitethernet 0/0/2
	[SwitchA-GigabitEthernet0/0/2]port link-type trunk
	[SwitchA-GigabitEthernet0/0/2]port trunk allow-pass vlan all
	[SwitchA-GigabitEthernet0/0/2]quit

	#启用接口的GARP功能，并配置接口注册模式
	[SwitchA]interface gigabitethernet 0/0/1
	[SwitchA-GigabitEthernet0/0/1]garp
	[SwitchA-GigabitEthernet0/0/1]garp registration normal
	[SwitchA-GigabitEthernet0/0/1]quit
	[SwitchA]interface gigabitethernet 0/0/2
	[SwitchA-GigabitEthernet0/0/2]garp
	[SwitchA-GigabitEthernet0/0/2]garp registration normal
	[SwitchA-GigabitEthernet0/0/2]quit
	
	配置完成后，在SwitchA使用display garp statistics，查看接口的GARP统计信息。
	其中包括GARP状态、GARP注册失败次数、上一个GARP数据单元MAC地址和接口GARP注册类型。

	[SwitchA]display garp statistics
	  GARP staitstics on port GigabitEthernet0/0/1
	     GARP status                    :Enabled
	     GARP registrations failed      :0
	     GARP last PDU origin           :0000-0000-0000
	     GARP registrations type        :Normal

	  GARP staitstics on port GigabitEthernet0/0/2
	     GARP status                    :Enabled
	     GARP registrations failed      :0
	     GARP last PDU origin           :0000-0000-0000
	     GARP registrations type        :Normal

##### 生成树协议的配置

	目的：实现交换机之间冗余连接的同时避免网络环路的出现，实现网络的高可用性。
	生成树协议通过阻断相应端口来消除网络环路
	在交换机之间传递BPDU（Bridge Protocol Data Unit，桥接协议数据单元），相互告知如交换机的桥ID、链路开销和根桥ID等信息，以确定根桥，从而决定将那些端口置于转发状态，将哪些端口至于阻断状态，用于消除环路。
	在网络规划中出于冗余备份的需要，在设备之间部署多条链路时，可以在网路中部署STP协议预防环路，避免广播风暴和MAC表项破坏。
	配置STP如下图，当前网络中都运行STP，通过相互的信息交换发现网路中存在的环路，有选择的对某个端口进行堵塞，将环形网络结构修剪成无环路的属性网络结构，从而避免网络环路造成的故障。

![](https://i.imgur.com/g9vGj10.png)	

	(1)配置STP基本功能
	配置环网中的设备生成树协议工作在STP模式
	
	#配置SwitchA的STP工作模式，其他交换机配置相同
	<HUAWEI>system-view
	[HUAWEI]sysname SwitchA
	[SwitchA]stp mode stp
	
	配置根桥和备份根桥设备
	#配置SwitchA为根桥
	[SwitchA]stp root primary
	
	#配置SwitchB为备份根桥
	[SwitchB]stp root secondary

	配置端口的路径开销值，实现将该端口阻塞。
	端口路径开销值取值范围由路径开销计算方法决定，这里选择使用华为计算方法为例，配置将被阻塞端口的路径开销值为20000，同一网络内所有交换设备的端口路径开销应使用相同的计算方法
	#配置SwitchA的端口路径开销计算方法为华为计算方法
	[SwitchA]stp pathcost-standard legacy
	
	#配置SwitchC端口GigabitEthernet0/0/1端口路径开销值为20000
	[SwitchC]stp pathcost-standard legacy
	[SwitchC]interface gigabitethernet 0/0/1
	[SwitchC-GigabitEthernet0/0/1]stp cost 20000
	[SwitchC-GigabitEthernet0/0/1]quit

	设备全局启用STP，所有设备配置相同

	#设备SwitchA全局启用STP
	[SwitchA]stp enable
	
	(2)检查配置结果
	执行display stp brief，查看端口状态和端口的保护类型
	[SwitchA]display stp brief
	  MSTID      port                  Role   STP State   Protection
	  0          GigabitEthernet0/0/1  DESI   FORWARDING  NONE
	  0          GigabitEthernet0/0/1  DESI   FORWARDING  NONE
		
	将SwitchA配置为根桥后，与SwitchB、SwitchD相连的端口GigabitEthernet0/0/2和GigabitEthernet0/0/1在生成树计算中被选举为指定端口
	
	display stp interface gigabitethernet 0/0/1 brief 查看你端口GigabitEthernet0/0/1状态

	[SwitchD]display stp interface gigabitethernet 0/0/2 brief
	MSTID       port                   Role     STP State   Protection
	0           GigabitEthernet0/0/1   DESI     FORWARDING  NONE
	
	[SwitchC]display stp brief
	MSTID       port                   Role     STP State   Protection
	0           GigabitEthernet0/0/1   ALTE     DISCARDING  NONE
	0           GIgabitEthernet0/0/3   ROOT     FORWARDING  NONE
	
	端口GigabitEtherney0/0/3在生成树选举中成为根端口，处于FORWARDING状态。端口GigabitEthernet0/0/1在生成树选举中成为Alternate端口，处于DISCARDING状态。

#### 路由协议：
	
	1.距离矢量（Distance Vector）路由协议计算网络中所有链路的矢量和距离并以此为依据确定最佳路径。使用距离矢量路由协议的路由器定期向其相邻的路由器发送全部或部分路由表。典型的距离矢量路由协议有RIP（Routing Information Protocol，路由选择信息协议）。
	2.链路状态（Link State）路由协议使用为每个路由器创建的拓扑数据库来创建路由表，每个路由器通过此数据库建立一个整个网络的拓扑图。在拓扑图的基础上通过相应的路由算法计算出通往各目标网段的最佳路径，并最终形成路由表。典型的链路状态路由协议是OSPF（Open Shortest Path First，开放最短路径优先）路由协议和IS-IS（Intermediate System to Intermediate System，属于内部网关协议IGP）。
	3.平衡混合（Balanced Hybrid）路由协议结合了链路状态和距离矢量两种协议的优点，此类协议的代表是BGP，即边界网关协议。

##### 路由器的基本配置
	
![](https://i.imgur.com/m4pnGHb.png)

	#设置系统的日期、时间和时区
	<Huawei>clock timezone BJ add 08:00:00
	<Huawei>clock datetime 20:10:00 2015-03-26
	
	#设置设备名称和管理IP地址
	<Huawei>system-view
	[Huawei]sysname Server
	[Server]interface gigabitethernet 0/0/0
	[Server-GigabitEthernet0/0/0]ip address 10.137.217.177 24
	[Server-GigabitEthernet0/0/0]quit

	#设置Telnet用户的级别和认证方式
	[Server]telnet server enable
	[Server]user-interface vty 0 4
	[Server-ui-vty0-4]user privilege level 15
	[Server-ui-vty0-4]authentication-mode aaa
	[Server-ui-vty0-4]quit
	[Server]aaa
	[Server-aaa]local-user admin1234 password inreversible-cipher Helloworld@6789
	[Server-aaa]local-user admin1234 privilege level 15
	[Server-aaa]local-user admin1234 service-type telnet
	[Server-aaa]quit

##### 批量配置技术
	
![](https://i.imgur.com/9GkRAKO.png)

	步骤1：配置SFTP服务器
	
	#配置SFTP服务器功能及参数
	<Huawei>system-view
	[Huawei]sysname SFTP Server
	[SFTP Server]rsa local-key-pair creare The key name will be: Host
	RSA keys defined for Host already exist.
	Confirm to replace them?(y/n)[n]:y
	The range of public key size is (512~2048).
	NOTES: If the key modulus if less then 2048,
	       It will introduce potential security risks.
	Input the bits in the modulus[default = 2048]:2048
	Generating keys...
	....................................................
	[SFTP Server]sftp server enable
	
	#配置SSH用户登陆的用户界面
	[SFTP Server]user-interface vty 0 4
	[STFP Server-ui-vty0-4]authentication-mode aaa
	[SFTP Server-ui-vty0-4]protocol inbound all
	[SFTP Server-ui-vty0-4]user privilege 15
	[SFTP Server-ui-vty0-4]quit
	
	#配置SSH用户
	[SFTP Server]aaa
	[SFTP Server-aaa]local-user user password
	Please configure the login password(8-128)
	It is recommended that the password consist of at least 2 bytes of characters, including lowercase letters, uppercase letters, numerals and special characters.
	Please enter password:
	Please confirm password:
	[SFTP Server-aaa]local-user user privilege level 15
	[SFTP Server-aaa]local-user user service-type ssh
	[SFTP Server-aaa]local-user user ftp0directory flash:\autoconfig
	[SFTP Server-aaa]quit
	[SFTP Server]ssh user authentication-type password
	
	#配置SFTP服务器的IP地址
	[SFTP Server]interface gigabitethernet 0/0/1
	[SFTP Server-GigabitEthernet0/0/1]ip address 172.16.100.100 255.255.255.0
	[SFTP Server-GigabitEthernet0/0/1]quit

	#在SFTP服务器上配置缺省路由
	[SFTP Server]ip route-static 0.0.0.0 0.0.0.0 172.16.100.1
	
	步骤2：将配置文件、系统软件和补丁文件上传至SFTP服务器的工作目录flash:\autoconfig上
	
	步骤3：配置DHCP服务器
	
	<Huawei>system-view
	[Huawei]sysname DHCP Server
	[DHCP Server]dhcp enable
	[DHCP Server]vlan 10
	[DHCP Server-vlan10]quit
	[DHCP Server]interface ethernet 1/0/1
	[DHCP Server-Ethernet1/0/1]port link-type hybrid
	[DHCP Server-Ethernet1/0/1]port hybrid untagged vlan 10
	[DHCP Server-Ethernet1/0/1]port hybrid pvid vlan 10
	[DHCP Server-Ethernet1/0/1]quit
	[DHCP Server]interface ethernet 1/0/2
	[DHCP Server-Ethernet1/0/2]port link-type hybrid
	[DHCP Server-Ethernet1/0/2]port hybrid untagged vlan 10
	[DHCP Server-Ethernet1/0/2]port hybrid pvid vlan 10
	[DHCP Server-Ethernet1/0/2]quit
	[DHCP Server]interface ethernet 1/0/3
	[DHCP Server-Ethernet1/0/3]port link-type hybrid
	[DHCP Server-Ethernet1/0/3]port hybrid untagged vlan 10
	[DHCP Server-Ethernet1/0/3]port hybrid pvid vlan 10
	[DHCP Server-Ethernet1/0/3]quit
	[DHCP Server]interface gigabitethernet 0/0/1
	[DHCP Server-GigabitEthernet0/0/1]ip address 172.16.100.1 255.255.255.0
	[DHCP Server-GigabitEthernet0/0/1]quit
	[DHCP Server]interface vlanif 10
	[DHCP Server-Vlanif10]ip address 172.16.200.100 255.255.255.0
	[DHCP Server-Vlanif10]dhcp select global
	[DHCP Server-Vlanif10]quit
	[DHCP Server]ip pool auto-config
	[DHCP Server-ip-pool-auto-config]network 172.16.200.0 mask 255.255.255.0
	[DHCP Server-ip-pool-auto-config]gateway-list 172.16.200.100
	[DHCP Server-ip-pool-auto-config]option 67 ascii ar_V200R008 (C20&C30) .cfg
	[DHCP Server-ip-pool-auto-config]option 141 ascii user
	[DHCP Server-ip-pool-auto-config]option 142 cipher huawei@123
	[DHCP Server-ip-pool-auto-config]option 143 ip-address 172.16.100.100
	[DHCP Server-ip-pool-auto-config]option 145 ascii vrpfile=auto_V200R008 (C20&C30) .cc; vrpver=V200R008 (C20&C30); pathfile=ar_V200R008 (C20&C30) .pat;
	[DHCP Server-ip-pool-auto-config]quit

	步骤4：待配置设备RouterA、RouterB、RouterC上电启动，Auto-Config流程开始运行
	
	步骤5:检查配置结果
	
	#Auto-Config流程结束后,登录到待配置设备执行命令display startup查看设备当前的启动系统软件,启动配置文件和启动补丁文件
	
	以RouterA为例
	<Huawei>display startup
	MainBoard:
	  Startup system software:                  flash:/ar_V200R008 (C20&C30) .cc
	  Next startup system software:             flash:/ar_V200R008 (C20&C30) .cc
	  Backup system software for next startup:  null
	  Startup saved-configuration file:         flash:/ar_V200R008 (C20&C30) .cfg
	  Next startup saved-configuration file:    flash:/ar_V200R008 (C20&C30) .cfg
	  Startup license file:                     null
	  Next startup license:                     null
	  Startup patch package:                    flash:/ar_V200R008 (C20&C30) .pat
	  Next startup patch package:               flash:/ar_V200R008 (C20&C30) .pat
	  Startup voice-files:                      null
	  Next startup voice-files:                 null

##### 配置静态路由
	
![](https://i.imgur.com/BRzqJT7.png)

	#ipv4
	#
	interface GigabitEthernet0/0/1      //接口视图配置R1的接口地址
	ip address 10.1.1.1 255.255.255.0
	#
	interface GigabitEthernet0/0/2
	ip address 10.1.4.1 255.255.255.252
	
	#
	ip route-static 10.1.2.0 255.255.255.0 10.1.4.2
	ip route-static 10.1.3.0 255.255.255.0 10.1.4.2
	#return

	#ipv6

![](https://i.imgur.com/fxACmvf.png)

	#
	ipv6           //启用路由器IPv6报文转发能力
	#
	interface GigabitEthernet1/0/0
	ipv6 enable   //在接口上启用IPv6
	ipv6 address 1::1 64
	#
	interface GigabitEthernet2/0/0
	ipv6 enable
	ipv6 address 3::1 64
	#
	ipv6 route-static 2:: 64 3::1
	#
	return

#### 路由选择信息协议（Routing Information Protocol，RIP）
##### RIP相关命令：
	rip [process-id] 进入RIP视图
	version 2 指定RIP版本2
	network network 指定与该路由器相连的网络
	display rip 1 route 查看路由表信息
	display rip route 查看RIP协议的路由信息
	display rip interface 查看RIP接口信息
	dis rip 1 neighbor 查看邻居关系

![](https://i.imgur.com/lJGsK7I.png)	
	
	#配置路由器R1接口的IP地址
	[R1]interface gigabitethernet 0/0/1
	[R1-GigabitEthernet0/0/2]ip address 192.168.1.1 24
	
	#配置路由器R1的RIP功能
	[R1]rip
	[R1-rip-1]network 192.168.1.0
	[R1-rip-1]quit
	
	#配置路由器R2的RIP功能
	[R2]rip
	[R2-rip-1]network 192.168.1.0
	[R2-rip-1]network 10.0.0.0
	[R2-rip-1]quit
	
	#配置路由器R3的RIP功能
	[R3]rip
	[R3-rip-1]network 10.0.0.0
	[R3-rip-1]network 172.16.0.0
	[R3-rip-1]quit
	
	#配置路由器R4的RIP功能
	[R4]rip
	[R2-rip-1]network 172.16.0.0
	[R4-rip-1]quit

	#查看路由器R1的RIP路由表
	[R1]display rip 1 route
	  Route Flags: R - RIP
	               A - Aging, S - Supressed, G - Garbage-collect
	------------------------------------------------------
	Peer 192.168.1.2 on GigabitEthernet0/0/1
	     Destination/Mask  Nexthop     Cost Tag Flags Sec
	     10.0.0.0/8        192.168.1.2 1    0   RA    1
	     172.16.0.0/16     192.168.1.2 2    0   RA    1
	从路由表可以看出,RIP-1发布的路由信息使用的是自然掩码
	
	#再路由器R1上配置RIP-2
	[R1]rip
	[R-rip-1]version 2
	[R1-rip-1]quit
	
	#查看路由器R1的RIP路由表
	[R1]display rip 1 route
	  Route Flags: R - RIP
	               A - Aging, S - Supressed, G - Garbage-collect
	------------------------------------------------------
	Peer 192.168.1.2 on GigabitEthernet0/0/1
	     Destination/Mask  Nexthop     Cost Tag Flags Sec
	     10.1.1.0/24       192.168.1.2 1    0   RA    4
	     172.16.1.0/24     192.168.1.2 2    0   RA    4
	从路由表中可以看出,RIP-2发布的路由中带有跟为精确的子网掩码信息
	
#### 双向转发检测协议（Bidirectional Forwarding Detection，BFD）
	bfd all-interfaces enable //启用bfd功能
	bfd all-interfaces min-rx-interval 100 min-tx-interval 100 detect-multiplier 10 //配置最小发送、时间间隔和检测时间倍数
	dis rip 1 bfd session all //查看BFD会话状态

##### RIP and BFD

![](https://i.imgur.com/XCmrZh6.png)

	#配置路由器R1接口的IP地址
	[R1]interface gigabitethernet 0/0/1
	[R1-GigabitEthernet0/0/1]ip address 192.168.1.2 24
	[R1-GigabitEthernet0/0/1]quit
	[R1]interface gigabitethernet 0/0/2
	[R1-GigabitEthernet0/0/2]ip address 192.168.2.2 24
	[R1-GigabitEthernet0/0/2]quit
	
	#配置路由器R1的RIP的基本功能
	[R1]rip 1
	[R1-rip-1]version 2
	[R1-rip-1]network 192.168.1.0
	[R1-rip-1]network 192.168.2.0
	[R1-rip-1]quit
	
	#查看路由器R1 R2以及路由器R4之间已经建立的邻居关系,及路由器R1的显示为例
	[R1]dis rip 1 neighbor
	-----------------------------------------------------
	  IP Address   Interface              Type   Last-Heard-Time
	-----------------------------------------------------
	  192.168.1.1  GigabitEthernet0/0/1   RIP    0:0:20
	Number of RIP routers: 1
	  192.168.2.1  GigabitEthernet0/0/2   RIP    0:0:12
	Number of RIP routers: 1
	
![](https://i.imgur.com/vr3Sy02.png)

	由此路由表看出去往目的地172.16.1.0/24的下一跳地址为192.168.1.1,接口是GigabitEthernet0/0/1,流量再主链路路由器R1---R2上进行传输

	#配置路由器R1上所有接口的BFD特性
	[R1]bfd
	[R1-bfd]quit
	[R1]rip 1
	[R1-rip-1]bfd all-interfaces enable  //启用bfd功能,并配置最小发送 时间间隔和检测时间倍数
	[R1-rip-1]bfd all-interfaces min-rx-interval 100 min-tx-interval 100 detect-multplier 10
	[R1-rip-1]quit

	R2的配置类似
	
	#完成上述配置之后,再路由器R1上执行命令display rip bfd session看到R1和R2之间已经建立起BFD绘画,BFDState显示为Up

![](https://i.imgur.com/x9On8pc.png)

	检验配置结果
	#在路由器R2的接口GigabitEthernet2/0/0上执行shutdown命令,模拟链路故障
	[R2]interface gigabitethernet2/0/0
	[R2-GigabitEthernet2/0/0]shutdown
	
![](https://i.imgur.com/GDUoubf.png)	

![](https://i.imgur.com/1ovvTCO.png)

##### 两台OSPF路由器形成OSPF邻居必须具备的四个条件：
	1.Area-id（区域号码）：路由器之间必须配置在相同的OSPF区域，否则无法成为邻居。
	2.Hello and Dead Interval（Hello时间与Dead时间）：路由器之间的Hello与Dead时间必须一致。
	3.Authentication（认证）：路由器之间必须配置相同的认证密码。
	4.Stub Area Flag（末节标签）：路由器之间的末节标签必须一致，即位于相同的末节区域内。
	
#### 中间系统到中间系统（Intermediate System to Intermediate System）
	属于内部网关协议（Interior Gateway Protocol），用于自治系统内部。
	自治系统内分为两层结构：骨干区域和非骨干区域
	Level-1路由器部署在非骨干区域
	Level-2路由器和Level-1-2路由器部署在骨干区域
	每一个非骨干区域都通过Level-1-2路由器与骨干区域相连
	链路状态包（Link Status Packet，LSP）
	
##### IS-IS相关命令：
	isis [process-id] 创建IS-IS进程并进入IS-IS试图
	isis circuit-level [level-1|level-1-2|level-2] 设置接口的Level级别，默认情况下，接口的Level级别为Level-1-2
	network-entity net 设置网络实体名称
	net 设施格式为X···X.XXXX.XXXX.XXXX.00，前面的"X···X"是区域地址，中间的12各"X"是路由器的System ID，最后的'00"是SEL
	isis enable [process-id] 指定IS-IS的进程号，默认为1，IS-IS将通过该接口建立邻居、扩散LSP报文
	display isis peer 查看IS-IS的邻居信息
	display isis route 查看IS-IS的路由信息

![](https://i.imgur.com/mJH5DwT.png)
	
	#配置R1路由器接口的IP地址，R2、R3和R4的配置与R1一致
	[R1]interface gigabitethernet 1/0/0
	[R1-GigabitEthernet1/0/0]ip address 10.1.1.2 24
	[R1-GigabitEthernet1/0/0]quit

	#配置R1的IS-IS基本功能，R2、R3和R4的配置与R1相似
	[R1]isis 1
	[R1-isis-1]is-level level-1
	[R1-isis-1]network-entity 10.0000.0000.0001.00
	[R1-isis-1]quit
	[R1]interface gigabitethernet 1/0/0
	[R1-GigabitEthernet1/0/0]isis enable 1
	[R1-GigabitEthernet1/0/0]quit
	
	#检查配置结果
	#显示各Router的IS-IS LSDB信息，查看LSDB是否同步，例如检查R1的信息命令如下：
	[R1]display isis ladb
			Database information for ISIS(1)
			-------------------------------
			  Level-1 Link State Database
	LSPID					Seq Num    Checksum	  Holdtime  Length  ATT/P/OL
	------------------------------------------------------------------------
	0000.0000.0001.00-00*	0x0000006   0xbf7d       649      68     0/0/0
	0000.0000.0002.00-00*	0x0000002   0xcfbb      1157      55     0/0/0
	0000.0000.0003.00-00	0x0000003   0xef4d       545      68     0/0/0
	0000.0000.0004.00-00	0x0000008   0x3340       582     111     1/0/0
	Total LSP(s): 4
	*(In LTV)-Leaking Route,*(By LSPID)-SelfLSP,+-SelfLSP(Extended),
	ATT-Attached, P-Partition, OL-Overload

	#显示各路由器的IS-IS路由信息。Level-1路由器的路由表中应该有一条默认路由，且下一跳为Level-1-2路由器，Level-2路由器应该有所有Level-1和Level-2的路由，例如检查R1的命令如下：
	[R1]display isis route
				Route information for ISIS(1)
			     --------------------------
		 	  ISIS(1) Level-1 Forwarding Table
	--------------------------------------------------------------------------
	IPV4 Destination    IntCost  ExtCost   ExitInterface   NextHop   	  Flags
	 172.16.30.0/24        10      NULL		  GE1/0/0       Direct		  D/-/L/-
	 172.16.10.0/24		   20	   NULL		  GE1/0/0	 172.16.30.1      A/-/-/-
	 159.74.112.0/24	   20	   NULL		  GE1/0/0	 172.16.30.1	  A/-/-/-
	 0.0.0.0/0 			   10	   NULL		  GE1/0/0    172.16.30.1	  A/-/-/-
		Flags: D-Direct, A-Added to URT, L-Advertised in LSPs, S-IGP Shortcut,
										                  U-Up/Down Bit Set
	#经过检查LSDB同步，并且R1与R2的路由条目较少，说明网络互通并且R1和R2承担较少的信息。

#### 开放最短路径优先（Open Shortest Path First，OSPF）
	OSPF只能使用接口的primary地址建立邻居，不能使用secondary地址。
	路由器双方接口要么均为手工配置地址（Numbered），要么均为借用地址（Unnumbered），否则无法建立邻居。
	链路状态通告（Link State Advertisement，LSA）
	主干区域为区域0



##### OSPF路由器分类
	内部路由器
	主干路由器
	区域边界路由器ABR
	自治系统边界路由器（ASBR）

##### OSPF的相关命令
	ospf [process-id|router-id router-id|vpn-instance-name] 启动OSPF进程，进入OSPF视图
	area area-id 创建并进入OSPF区域视图
	netwerk ip-address wildcard-mask 创建区域所包含的网段
	display ospf peer 查看OSPF邻居信息
	display ospf routing 查看OSPF路由信息

![](https://i.imgur.com/n6ogKj7.png)

##### 配置OSPF协议
	#配置R1路由器接口的IP地址
	<Huawei>system-view
	[Huawei]sysname R1
	[R1]interface gigabitethernet 0/0/1
	[R1-GigabitEthernet0/0/1]ip address 192.168.1.1 24
	[R1-GigabitEthernet0/0/1]quit
	[R1]interface gigabitethernet0/0/1
	[R1-GigabitEthernet0/0/2]ip address 192.168.2.1 24
	[R1-GigabitEthernet0/0/2]quit

	#在路由器R1上配置OSPF基本功能
	[R1]router id 1.1.1.1
	[R1]ospf
	[R1-ospf-1]area 0
	[R1-ospf-1-0.0.0.0]network 192.168.1.0 0.0.0.255
	[R1-ospf-1-0.0.0.0]quit
	[R1-ofps-1]area 1
	[R1-ospf-1-0.0.0.1]network 192.168.2.0 0.0.0.255
	[R1-ospf-1-0.0.0.1]quit
	[R1-ospf-1]quit

	#路由器R2、R2、R4、R5和R6路由器的配置与R1相似
	
	#在路由器R1上查看路由表
	<R1>dis ip rout
	Route Flags: R - relay, D - download to fib
	--------------------------------------------------------
	Routing Tables: Public
				Destinaions: 13			Routes: 13
	Destination/Mask    Proto   Pre   Cost   Flags   NextHop      Interface
	127.0..0/8         Direct  0     0      D       127.0.0.1      InLoopBack0
	127.0.0.1/32        Direct  0     0      D       127.0.0.1      InLoopBack0
	127.255.255.255/32  Direct  0     0      D       127.0.0.1      InLoopBack0
	192.168.1.0/24      Direct  0     0      D       192.168.1.1    GigabitEthernet0/0/1
	192.168.1.1/32      Direct  0     0      D       127.0.0.1      GigabitEthernet0/0/1
	192.168.1.255/32    Direct  0     0      D       127.0.0.1      GigabitEthernet0/0/1
	192.168.2.0/24      Direct  0     0      D       192.168.2.1    GigabitEthernet0/0/2
	192.168.2.1/32      Direct  0     0      D       127.0.0.1      GigabitEthernet0/0/2
	192.168.2.255/32    Direct  0     0      D       127.0.0.1      GigabitEthernet0/0/2
	192.168.3.0/24      OSPF    10    2      D       192.168.2.2    GigabitEthernet0/0/2
	192.168.4.0/24      OSPF    10    2      D       192.168.1.2    GigabitEthernet0/0/1
	192.168.5.0/24      OSPF    10    3      D       192.168.1.2    GigabitEthernet0/0/1
	255.255.255.255/32  Direct  0     0      D       127.0.0.1      InLookBack0
	
	#在路由器R5与路由器R6之间的连通性，在带R5源地址ping命令测试
	<R5>ping -a 192.168.3.2 192.168.5.2
	  PING 192.168.5.2:56 data bytes, press CTRL_C to break
		Reply from 192.168.5.2:bytes=56 Sequence=1 ttl=251 time=30ms
		Reply from 192.168.5.2:bytes=56 Sequence=1 ttl=251 time=50ms
		Reply from 192.168.5.2:bytes=56 Sequence=1 ttl=251 time=40ms
		Reply from 192.168.5.2:bytes=56 Sequence=1 ttl=251 time=30ms
		Reply from 192.168.5.2:bytes=56 Sequence=1 ttl=251 time=40ms
	
	  --- 192.168.5.2 ping statistic ---
		5 packet(s) transmitted
		5 packet(s) received
		0.00% packet loss
		round-trip min/avg/max = 30/38/50 ms
	
	#查看路由器R1的OSPF邻居
	<R1>display ospf peer
		 OSPF Process 1 with Router ID 1.1.1.1
				Neighbors
	Area 0.0.0.0 interface 192.168.1.1(GigaEthernet0/0/1)'s neighbors
	Router ID: 2.2.2.2			Address: 192.168.1.2
		State: Full    Mode: Nbr is   Master   Priority: 1
		DR: 192.168.1.1      BDR: 192.168.1.2     MTU: 0 
		Dead timer due in 32     sec 
		Retrans timer interval: 5 
		Neighbor is up for 01:06:23 
		Authentication Sequence: [ 0 ] 
			    Neighbors 
	Area 0.0.0.1 interface 192.1 68.2.1 (GigabitEthemet0/0/2)'s neighbors 
	Router ID: 3.3.3.3            Address: 192.168.2.2 
		State: Full    Mode:Nbr is    Master   Priority: I 
		DR: 192.168.2.1     BDR: 192.168.2.2      MTU: 0 
		Dead timer due in 28     sec 
		Retrans timer interval: 5 

	#显示路由器R1的OSPF路由信息
	<R1>display ospf routing
		  OSPF Process 1 with Router ID 1.1.1.1
				Routing Tables
	 Routing for Network
	 Destination	 Cost   Type		NextHop	      AdvRouter	  Area
	 192.168.1.0/24	 1	   Transit	    192.168.1.1	  1.1.1.1	  0.0.0.0
	 192.168.2.0/24	 1	   Transit	    192.168.2.1	  1.1.1.1	  0.0.0.1
	 192.168.3.0/24	 2	   Transit	    192.168.2.2	  3.3.3.3	  0.0.0.1
	 192.168.4.0/24	 2	   Inter-area	192.168.1.2	  2.2.2.2	  0.0.0.0
	 192.168.5.0/24	 3	   Inter-area	192.168.1.2	  2.2.2.2	  0.0.0.0
	 Total Nets: 5
	 Intra Area: 3    Inter Area: 2    ASE: 0    NSSA: 0

#### 边界网关协议（Border Gateway Protocol，BGP）

##### BGP的相关命令
	bgp{as-number-plain|as-number-dot} 启动BGP，制定本地AS编号，并进入BGP试图
	router-id ipv4-address 配置BGP的Router ID
	peer{ipv4-address|ipv6-address} as-number{as-number-plain|as-number-dot} 创建BGP对等体
	ipv4-family{unicast|multicast} 进入IPv4地址族视图
	import-route direct 管理IP所在的网段路由，并引入RIP路由表

![](https://i.imgur.com/FAOrkAJ.jpg)

	#配置各接口的IP地址，配置R1，其他路由器各接口的IP地址与此配置一致
	<R1>system-view
	[R1]interfacegigaethernet 1/0/0
	[R1-GigabitEthernet1/0/0]ip address 172.16.60.1
	[R1-GigabitEthernet1/0/0]quit

	#配置IBGP连接，配置R2、R3、R4
	[R2]bgp 65009
	[R2-bgp]router-id 2.2.2.2
	[R2-bgp]peer 172.16.10.2 as-number 65009
	[R2-bgp]peer 172.16.30.2 as-number 65009

	[R3]bgp 65009
	[R3-bgp]router-id 3.3.3.3
	[R3-bgp]peer 172.16.30.1 as-number 65009
	[R3-bgp]peer 172.16.20.2 as-number 65009
	[R3-bgp]quit

	[R4]bgp 65009
	[R4-bgp]router-id 4.4.4.4
	[R4-bgp]peer 59.74.112.1 as-number 65009
	[R4-bgp]peer 172.16.20.1 as-number 65009

	#配置EBGP连接，配置R1、R2
	[R1]bgp 65008
	[R1-bgp]router-id 1.1.1.1
	[R1-bgp]peer 59.74.112.1 as-number 65009

	[R2-bgp]peer 59.74.112.2 as-number 65008

	#查看BGP对等体的连接状态
	[R2-bgp]display gbp peer
	  BGP local router ID: 2.2.2.2
	  Local AS number: 65009
	  Total number of peers: 3              Peers in established state: 3
	  Peer         V    AS      MsgRcvd    MsgSent    QutQ         Up/Down      State PrefRcv
	  172.16.10.0  4    65009   49         62         0 00:44:58   Established  0
	  172.16.30.0  4    65009   56         56         0 00:40:54  Established  0
      54.74.112.2  4    65008   49         65         0 00:44:03   Established  1

	#配置R1发布路由172.16.60.0/24
	[R1-bgp]ipv4-family unicast
	[R1-bgp-af-ipv4]network 172.16.60.0 255.255.255.0
	[R1-bgp-af-ipv4]quit

	#查看R1路由表信息
	[R1-bgp]display bgp routing-table
	  BGP Loacal router ID is 1.1.1.1
	  Status codes: *-valid, >-best, d-damped,
	                    h-history, i-internal, s-supressed, S-Stale
	                    Origin: i-IGP, e-EGP, ?-incomplete
	  Total Number of Routes: 1
	         Network         NextHop         MED        LocPrf        PreVal          Path/Ogn
	  *>     172.16.60.0     0.0.0.0         0                        0               i

	#查看R2的路由表
	[R2-bgp]diaplay bgp routing-table
	  BGP Local router ID is 2.2.2.2
	  State codes: *-valid, >-best, d-damped,
	                  h-history, i-internal, s-supressed, S-State
	                  Origin: i-IGP, e-EGP, ?-incomplete
	  Total Number of Routers: 1
	         Network        NextHop         MED     LocPrf    PreVal      Path/Ogn
	  *>     172.16.60.0    59.74.112.2     0                 0           65008i

	#查看R3的路由表
	[R3]display bgp routing-table
	  BGP Local router ID is 3.3.3.3
	  State codes: *-valid, >-best, d-damped,
	                  h-history, i-internal, s-supressed, S-State
	                  Origin: i-IGP, e-EGP, ?-incomplete
	  Total Number of Routers: 1
	         Network        NextHop         MED     LocPrf    PreVal      Path/Ogn
	  *>     172.16.60.0    59.74.112.2     0                 0           65008i

	从路由表可以看出，R3虽然学到了AS65008中的172.16.60.0的路由，但因为下一跳59.47.112.2不可达，所以不是有效路由。
	
	#配置BGP引入直连路由，配置R2
	[R2-bgp]ipv4-family unicast
	[R2-bgp-af-ipv4]import-route direct

	#查看R1的BGP路由表
	[R1-bgp]dispaly bgp routing-table
	  BGP Local router ID is 1.1.1.1
	  State codes: *-valid, >-best, d-damped,
	                  h-history, i-internal, s-supressed, S-State
	                  Origin: i-IGP, e-EGP, ?-incomplete
	  Total Number of Routers: 4
	         Network        NextHop         MED     LocPrf    PreVal      Path/Ogn
      *>     172.16.60.0    0.0.0.0         0                 0           i
	  *>     172.16.10.0    59.74.112.1     0                 0           65009?
	  *>     172.16.30.0    59.74.112.1     0                 0           65009?
	         172.16.60.0    59.74.112.1     0                 0           65009?

	#查看R3的路由表
	[R3]dispaly bgp routing-table
	  BGP Local router ID is 3.3.3.3
	  State codes: *-valid, >-best, d-damped,
	                  h-history, i-internal, s-supressed, S-State
	                  Origin: i-IGP, e-EGP, ?-incomplete
	  Total Number of Routers: 4
	         Network        NextHop         MED     LocPrf    PreVal      Path/Ogn
      *>i    172.16.60.0    59.74.112.1     0       100       0           65008i?
	  *>i    172.16.10.0    172.16.30.1     0       100       0           ?
	    i    172.16.30.0    172.16.30.1     0       100       0           ?
	  *>i    172.16.60.0    172.16.30.1     0       100       0           ?

	可以看出，到172.16.60.0的路由变为有效路由，下一跳为R1的地址

	#使用Ping进行网络连通性检查
	[R3]ping 172.16.60.1
	  PING 172.16.60.1: 56 data bytes, press CTRL_C ot break
	    Reply from 172.16.60.1: bytes=56 Sequence=1 ttl= 254 time=23ms
	    Reply from 172.16.60.1: bytes=56 Sequence=1 ttl= 254 time=56ms
	    Reply from 172.16.60.1: bytes=56 Sequence=1 ttl= 254 time=36ms
	    Reply from 172.16.60.1: bytes=56 Sequence=1 ttl= 254 time=14ms
	    Reply from 172.16.60.1: bytes=56 Sequence=1 ttl= 254 time=46ms

	---172.16.60.1 ping statistics---
	    5 packet(s) transmitted
	    5 packet(s) recieved
	    0.00% packet loss
	    round-trip min/avg/max = 14/35/56 ms

#### 配置PPP和DCC

##### PPP
	PPP具有多协议支持的特点，可以支持IP、IPX和DECnet等第三层协议。
	PPP提供了安全认证机制，这主要通过PAP（口令认证协议）和CHAP（挑战握手协议）来实现的。PAP和CHAP被用来认证是否允许对端设备进行拨号连接。
	多链路PPP是PPP的另一项功能，它允许在路由器和路由器之间或路由器和拨号的PC之间建立多条链路，通信量在这些链路之间进行负载均衡，从而提高了可用宽带和链路的可靠性。

###### DCC
	按需拨号路由（Dial Control Center, DCC）是利用拨号链路实现网络互联的一种常用技术。主要功能为：
	将数据包从被拨号的接口进行路由
	决定何种数据包可以出发拨号
	触发拨号
	决定什么时候终止连接
	DCC技术和PPP技术一样对于ISDN的配置是非常重要的，在实际应用中ISDN、PPP和DCC这三项技术经常综合使用。

##### PPP的相关配置命令
	interface mp-group 创建MP-Group接口并进入MP-Group接口视图
	local-user user-name password 创建本地账号，并配置本地账号的登录密码
	local-user user-name service-type ppp 配置本地用户使用的服务类型为PPP
	ppp authentication-mode {chap|pap}[[call-in]domain domain-name] 配置本端设备对对端设备的认证方式
	authentication-scheme scheme-name 建立认证方案
	domain domain-name 配置默认域
	ppp chap user username 配置采用CHAP认证时认证方的用户名
	ppp mp mp-group number 物理接口加入指定的组

![](https://i.imgur.com/ArJMrwy.png)

	配置路由器R1和R2，实现从总部到分支机构的网络连通，通过是提供拨号连接的安全性

	#在R1上创建并配置多链路MP-Group
	<Huawei>system-view
	[Huawei]sysname R1
	[R1]interface mp-group 0/0/1
	[R1-Mp-group0/0/1]ip address 10.10.10.9 30

	#配置物理接口Serial1/0/0、Serial1/0/1加入MP-Group，并配置接口采用CHAP认证，配置设备双向认证方时需要配置的本地用户和作为被认证方时需要的CHAP认证用户名和密码
	[R1]aaa
	[A1-aaa]local-user userb password
	Please configure the login password(8-128)
	It is recommand that the password consist of at least 2 types of characters, including lowercase letters, usppercase letters, numerals and special characters.
	Please enter password:
	Please confirm password:
	Info: Add a new user.
	Warning: The new user supports all access modes. The management user access modes such as Telnet, SSH, FTP, HTTP, and Terminal have security risks. You are advised to configure the required access modes only.
	[R1-aaa]local-user userb service-type ppp
	[R1-aaa]authentication-scheme system_a
	[R1-aaa-system_a]authentication-mode local
	[R1-aaa-system_a]quit
	[R1-aaa]domain system
	[R1-aaa-domain-system]authentication-scheme system_a
	[R1-aaa-domain-system]quit
	[R1-aaa]quit
	[R1]interface Serial 1/0/0
	[R1-Serial1/0/0]ppp authentication-mode chap domain system
	[R1-Serial1/0/0]ppp chap user usera
	[R1-Serial1/0/0]ppp chap password cipher usera@123
	[R1-Serial1/0/0]ppp mp my-group 0/0/1
	[R1-Serial1/0/0]quit
	[R1]interface Serial 1/0/1
	[R1-Serial1/0/1]ppp authentication chap domain system
	[R1-Serial1/0/1]ppp chap user usera
	[R1-Serial1/0/1]ppp chap password cipher usera@123
	[R1-Serial1/0/1]ppp mp mp-group 0/0/1
	[R1-Serial1/0/1]quit

	#在RouterA上执行命令display ppp mp查看绑定效果
	[R1]display ppp mp interface Mp-group 0/0/1
	Mp-group is Mp-group0/0/1
	====================Sublinks status begin========
	Serial1/0/0 physical UP, protocol UP
	Serial1/0/1 physical UP, protocol UP
	====================Sublinks status end==========
	Bundle Multilink, 2 members, slot 0, Master link is Mp-group0/0/1
	 0 lost fragments, 0 reordered, 0 unassigned,
	sequence 0/0 rcvd/sent
	The bundled sub channels are:
	     Serial1/0/0
	     Serial1/0/1

	#根据显示信息可以看出MP子链路的物理状态和协议状态、子链路数及MP的成员信息
	
	#在R1上执行命令display interface mp-group 查看绑定效果
	[R1]display interface mp-group 0/0/1
	Mp-group0/0/1 current state: UP
	Line protocol current state: UP
	Last line protocol up time: 2016-07-03 13:33:26
	Description: HUAWEI, AR Series, Mp-group0/0/1 Interface
	Route Port, The Maximum Transmit Unit is 1500
	Internet Address is 10.10.10.9/30
	Link layer protocol is PPP
	LCP opened, MP opened, IPCP opened
	Physical is MP, baudrate is 64000 bps
	Current system time: 2016-07-03 13:36:50
	    Last 300 seconds input rate 0 bytes/sec, 0 packets/sec
	    Last 300 seconds output rate 0 bytes/sec, 0 packets/sec
	    Realtime 0 seconds input rate 0 bytes/sec, 0 packets/sec
	    Realtime 0 seconds output rate 0 bytes/sec, 0 packets/sec
	    6 packets input, 84 bytes, 0 drops
	    6 packets output, 84 bytes, 0 drops
	    Input bandwidth utilization: 0.00%
	    Output bandwidth utilization: 0.00%

	#根据显示信息可以看出MP-Group接口的状态为Up，链路层协议为PPP，LCP协商、MP协商及IPCP协商状态为Opened等信息

#### 配置帧中继
	帧中继是一种高性能的WAN协议，运行在OSI参考模型的物理层和数据链路层。它是一种数据包交换技术，是X.25的简化版本。
	帧中继严格地对应于OSI参考模型的最低两层，而X.25还提供第三层的服务，所以帧中继比X.25具有更高的性能和更有效的传输效率。
	帧中继广域网的设备分为DTE和DCE。
	DTE表示数据终端设备，DCE表示数据通信设备，用于将用户DTE设备接入网络。
	帧中继技术提供面向连接的数据链路层通信，在没对设备之间都存在一条定义好的通信链路，且该链路有一个链路标识码。
	这种服务通过帧中继虚电路实现，每个帧中继虚电路都以数据链路识别码（DLCI）标识自己。
	DLCI的值一般由帧中继服务提供商指定。帧中继既支持PVC也支持SVC。

##### 帧中继的相关配置命令
	link-protocol fr 设置Frame Relay封装
	fr interface-type dte 设置Frame Relay接口类型DTE
	fr dlci dlci 配置帧中继链路的数据连接标识符
	fr map ip 配置本端DLCI到对端IP地址的静态映射

##### 帧中继IP业务组网，实现路由器R1和R2的联通

![](https://i.imgur.com/s5Ha4ZM.png)

	[R1]interface serial 1/0/0.1
	[R1-Serial1/0/0.1]fr flci 70
	[R1-fr-dlc-Serial1/0/0.1-70]quit
	[R1-Serial1/0/0.1]ip address 10.10.10.3 30
	[R1-Serial1/0/0.1]fr map ip 10.10.10.10 70
	[R1-Serial1/0/0.1]quit

	#在R2上的配置命令类似，通过在R2上ping对端可以检测帧中继组网是否联通

#### 配置ISDN
	综合业务数字网（Integrated Service Digital Network，ISDN）是电话网络数字化的结果，由数字电话和数据传输服务两部分组成，可以在ISDN上传输声音、数据和视频等多种信息。
	ISDN组件包括种端、终端适配器、网络终端设备、线路终端设备和交换终端设备等。
	ISDN提供了两种类型的访问接口，即基本速率接口（Basic Rate Interface，BRI）和主要速率接口（Primary Rate Interface，PRI）。
	ISDN BRI提供两个B信道和一个D信道（2B+D）。ISDN的B信道为承载信道，其速率为64kbps，用于传输用户数据；D信道速率为16kbps，主要用于传输控制信息。
	PRI提供30个B信道和一个D信道（30B+D），其B信道和D信道的速率均为64kbps。
	
##### ISDN的相关配置命令
	dialer-rule 进入Dialer-rule视图
	dialer-rule dialer-rule-number {acl{acl-number|name acl-name}|ip{deny|permit}|ipv6{deny|permit}} 配置某个拨号访问组对应的拨号访问控制列表，指定引发DCC呼叫的条件
	dialer enable-circular 使能轮询DCC功能
	interface bri interface-number 进入指定的ISDN BRI接口
	display isdn call-info[interface interface-type interface-number] 查看ISDN接口的当前呼叫状态
	isdn statistics {clear|continue|display[flow]|start|stop} ISDN接口信息统计
	
![](https://i.imgur.com/XLrvhYK.png)

	#配置R1，配置拨号控制列表
	<Huawei>system-view
	[Huawei]sysname R1
	[R1]dialer-rule
	[R1-dialer-rule]dialer-rule 1 ip permit
	[R1-dialer-rule]quit

	#配置帧中继地址映射
	[R1]interface dialer 0
	[R1-Dialer0]link-protocol fr
	Warning: The encapsulation protocol of the link will be changed. Continue? [Y/N]:y
	[R1-Dialer0]ip address 10.10.10.9 30
	[R1-Dialer0]fr dlci 70
	[R1-fr-dlci-Dialer0-70]quit
	[R1-Dialer]fr map ip 10.10.10.10 70
	
	#配置拨号控制列表关联接口
	[R1-Dialer0]dialer-group 1
	
	#使能轮询DCC
	[R1-Dialer0]dialer enable-circular
	
	#配置R1向R2发起呼叫
	[R1-Dialer0]dialer number 800011
	[R1-Dialer0]quit

	#配置物理接口并将物理接口加入拨号循环组（Dialer Dircular Group）
	[R1]interface bri 1/0/0
	[R1/0/0]link-protocol fr
	Warning: The encapsulation protocol of the link will be changed. Continue?[Y/N]:y
	[R1-Bri1/0/0]dialer circular-group 0

#### IPSec配置与测试
	
##### 网络拓扑
	
![](https://i.imgur.com/6PTCcUl.png)

##### 配置与测试

![](https://i.imgur.com/Eiu03m9.png)

两端路由器的配置

(1)	分别在总部路由器R1和分支机构路由器R2配置接口地址和静态路由
	
	<Huawei>system-view
	[Huawei]sysname R1
	[R1]interface gigabitethernet 1/0/0
	[R1-GigabitEthernet1/0/0]ip address 168.1.1.1 255.255.255.0
	[R1-GigabitEthernet1/0/0]quit
	[R1]interface gigabitethernet 2/0/0
	[R1-GigabitEthernet2/0/0]ip address 172.22.1.100 255.255.255.0
	[R1-GigabitEthernet2/0/0]quit
	[R1]ip route-static 167.1.1.1 255.255.255.0 168.1.1.2 (到对端下一跳的地址为168.1.1.2）
	[R1]ip route-static 172.22.2.0 255.255.255.0 168.1.1.2
	
	<Huawei>system-view
	[Huawei]sysname R2
	[R2]interface gigabitethernet 1/0/0
	[R2-GigabitEthernet1/0/0]ip address 167.1.1.1 255.255.255.0
	[R2-GigabitEthernet1/0/0]quit
	[R2]Interface gigabitethernet 2/0/0
	[R2-GigabitEthernet2/0/0]ip address 172.22.2.100 255.255.255.0
	[R2-GigabitEthernet2/0/0]quit
	[R2]ip route-static 168.1.1.0 255.255.255.0 167.1.1.2 (到对端下一跳的地址为167.1.1.2）
	[R2]ip route-static 172.22.1.0 255.255.255.0 167.1.1.2
	
(2)分别在R1和R2上配置ACL，定义各自要保护的数据流
	
	#在R1上配置ACL，定义由子网172.22.1.0/24去子网172.22.2.0/24的数据流
	[R1]acl number 3101
	[R1-acl-adv-3101]rule permit ip source 172.22.1.0 0.0.0.255 destination 172.22.2.0 0.0.0.255
	[R1-acl-adv-3101]quit
	
	#在R2上配置ACL，定义由子网172.22.2.0/24去子网172.22.1.0/24的数据流
	[R2]acl number 3101
	[R2-acl-adv-3101]rule permit ip source 172.22.2.0 0.0.0.255 destination 172.22.1.0 0.0.0.255
	[R2-acl-adv-3101]quit

(3)分别在R1和R2上创建IPSec安全提议
	
	#在R1上配置IPSec安全提议
	[R1]ipsec proposal tran1
	[R1-ipsec-proposal-tran1]esp authentication-algorithm sha2-256
	[R1-ipsec-proposal-tran1]esp encryption-algorithm acs-128
	[R1-ipsec-proposal-tran1]quit

	#在R2上配置IPSec安全提议
	[R2]ipsec proposal tran1
	[R2-ipsec-proposal-tran1]esp authentication-algorithm sha2-256
	[R2-ipsec-proposal-tran1]esp encryption-algorithm aes-128
	[R2-ipsec-proposal-tran1]quit
	
此时分别在R1和R2上执行display ipsec proposal会显示所配置的信息

(4)分别在R1和R2上配置IKE对等体
	
	#在R1上配置IKE安全提议
	[R1]ike proposal 5
	[R1-ike-proposal-5]encryption-algorithm acs-128
	[R1-ike-proposal-5]authentication-slgorithm sha2-256
	[R1-ike-proposal-5]dh group14
	[R1-ike-proposal-5]quit
	
	#在R1上配置IKE对等体，并根据默认配置，配置预共享密钥和对端ID
	[R1]ike peer spub
	[R1-ike-peer-spub]undo version 2
	[R1-ike-peer-spub]ike-proposal 5
	[R1-ike-peer-spub]pre-shared-key cipher huawei
	[R1-ike-peer-spub]remote-address 167.1.1.1
	[R1-ike-peer-spub]quit
	
	#在R2上配置IKE安全提议
	[R2]ike proposal 5
	[R2-ike-proposal-5]encryption-algorithm aes-128
	[R2-ike-proposal-5]authentication-algorithm sha2-256
	[R2-ike-proposal-5]dh group14
	[R2-ike-proposal-5]quit

	#在R2上配置IKE对等体，并根据默认配置，配置预共享密钥和对端ID
	[R2]ike peer spua
	[R2-ike-peer-spua]undo version 2
	[R2-ike-peer-spua]ike-proposal 5
	[R2-ike-peer-spua]pre-shared-key cipher huawei
	[R2-ike-peer-spua]remote-address 192.168.1.1
	[R2-ike-peer-spua]quit
	
(5)分别在R1和R2上创建安全策略
	
	#在R1上配置IKE动态协商方式安全策略
	[R1]ipsec policy map1 10 isakmp
	[R1-ipsec-policy-isakmp-map1-10]ike-peer spub
	[R1-ipsec-policy-isakmp-map1-10]proposal tran1
	[R1-ipsec-policy-isakmp-map1-10]security acl 3101
	[R1-ipsec-policy-isakmp-map1-10]quit

	#在R2上配置IKE动态协商方式安全策略
	[R2]ipsec policy use1 10 isakmp
	[R2-ipsec-policy-isakmp-use1-10]ike-peer spua
	[R2-ipsec-policy-isakmp-use1-10]proposal tran1
	[R2-ipsec-policy-isakmp-use1-10]security acl 3101
	[R2-ipsec-policy-isakmp-use1-10]quit

此时分别在R1和R2上执行display ipsec policy会显示所配置的信息
	
(6)分别在RouterA和RouterB的接口上应用各自的安全策略组，使接口具有IPSec的保护功能。

	#在R1的接口上引用安全策略组
	[R1]interface gigabitethernet 1/0/0
	[R1-GigabitEthernet1/0/0]ipsec policy map1
	[R1-GigabitEthernet1/0/0]quit
	
	#在R2的接口上引用安全策略组
	[R2]interface gigabitethernet 1/0/0
	[R2-GigabitEthernet1/0/0]ipsec policy use1
	[R2-GigabitEthernet1/0/0]quit

(7)测试配置结果

	#配置成功后，总部和分支机构的PC执行ping操作正常，它们之间的数据传输将被加密，执行命令display ipsec statistics可以查看数据包的统计信息
	
	#在R1上执行display ike sa操作，结果如下：
	[R1]display ike sa
	         Conn-ID      Peer        VPN       Flag(s)    Phase
	----------------------------------------------------------------
	         16           167.1.1.1   0         RD|ST      v1:2
	         14           167.1.1.1   0         RD|ST      v1:1
	Number of SA entries: 2
	Number of SA entries of all cpu: 2
	Flag Description:
	RD--READY  ST--STAYALIVE  RL--REPLACED  FD--FADING  TO--TIMEOUT  HRT--HEARTBEAT  LKG--LAST KNOWN GOOD SEQ NO  BCK--BACKED UP  M--ACTIVE S--STANDBY  A--ALONE  NEG--NEGOTIATING

#### 网络地址翻译（Network Address Translators，NAT）
	动态地址翻译（Dynamic Address Translators）
	存根区（Stub Domain）：内部网络的抽象，这样的网络只处理源和目标都在子网内部的通信。
	网络地址和端口翻译（Network Address Port Translation，NAPT）

#### 无类别的域间路由技术（Classless Inter Domain Routing，CIDR）
